<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Word Game (Supabase Edition)</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
      text-align: center;
      padding: 40px;
    }
    button {
      background-color: #3b82f6;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    input {
      padding: 10px;
      border-radius: 6px;
      border: none;
      width: 250px;
      font-size: 16px;
    }
    .hidden {
      display: none;
    }
    .link-box {
      margin-top: 20px;
      background: #1e293b;
      padding: 15px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>🎮 Secret Word Game</h1>

  <div id="create-section">
    <button id="createRoomBtn">Create Game Link</button>
    <div class="link-box hidden" id="linkBox">
      <p>Share this link with players:</p>
      <input type="text" id="roomLink" readonly />
      <button onclick="copyLink()">Copy</button>
    </div>
  </div>

  <div id="join-section">
    <h3>Or Join a Game</h3>
    <input type="text" id="joinRoomId" placeholder="Enter Room ID" />
    <button id="joinRoomBtn">Join</button>
  </div>

  <div id="game-section" class="hidden">
    <h2 id="roomDisplay"></h2>
    <p>Your word is:</p>
    <h1 id="wordDisplay"></h1>
  </div>

  <script>
    // ✅ Your Supabase project info
    const SUPABASE_URL = "https://zaqiefpfwnwnsflfbloq.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InphcWllZnBmd253bnNmbGZibG9xIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNTEyMjksImV4cCI6MjA3NjcyNzIyOX0.sopNAnbCiOmJimpnvf2GOI8WJkxaPgAk7Clv4L-aKAg";

    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Elements
    const createRoomBtn = document.getElementById("createRoomBtn");
    const linkBox = document.getElementById("linkBox");
    const roomLink = document.getElementById("roomLink");
    const joinRoomBtn = document.getElementById("joinRoomBtn");
    const joinRoomId = document.getElementById("joinRoomId");
    const roomDisplay = document.getElementById("roomDisplay");
    const wordDisplay = document.getElementById("wordDisplay");
    const gameSection = document.getElementById("game-section");

    // Generate random room id
    function generateRoomId() {
      return Math.random().toString(36).substring(2, 8);
    }

    // Generate random words
    const words = ["Apple", "Banana", "Mango", "Orange", "Cherry", "Peach"];

    // ✅ Create Game Link
    createRoomBtn.addEventListener("click", async () => {
      const roomId = generateRoomId();
      const randomWord = words[Math.floor(Math.random() * words.length)];

      const { data, error } = await supabase
        .from("rooms") // ✅ Correct table name
        .insert([{ room_id: roomId, word: randomWord }]);

      if (error) {
        alert("❌ Error creating room: " + error.message);
        console.error(error);
        return;
      }

      const link = `${window.location.origin}?room=${roomId}`;
      roomLink.value = link;
      linkBox.classList.remove("hidden");
    });

    // ✅ Join Game
    joinRoomBtn.addEventListener("click", async () => {
      const roomId = joinRoomId.value.trim();
      if (!roomId) return alert("Enter a valid Room ID!");

      const { data, error } = await supabase
        .from("rooms")
        .select("word")
        .eq("room_id", roomId)
        .single();

      if (error || !data) {
        alert("Room not found!");
        return;
      }

      roomDisplay.innerText = `Room ID: ${roomId}`;
      wordDisplay.innerText = data.word;
      gameSection.classList.remove("hidden");
    });

    // ✅ Auto-join via shared link
    const urlParams = new URLSearchParams(window.location.search);
    const sharedRoom = urlParams.get("room");
    if (sharedRoom) {
      joinRoomId.value = sharedRoom;
      joinRoomBtn.click();
    }

    // ✅ Copy link
    function copyLink() {
      roomLink.select();
      document.execCommand("copy");
      alert("Link copied!");
    }
  </script>
</body>
</html>
